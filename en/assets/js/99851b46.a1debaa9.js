"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[2355],{70144:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"plugin/quickstart","title":"\u5feb\u901f\u5165\u95e8","description":"\u672c\u6307\u5357\u5c06\u5e2e\u52a9\u4f60\u5728 5 \u5206\u949f\u5185\u521b\u5efa\u5e76\u8fd0\u884c\u7b2c\u4e00\u4e2a TGO \u63d2\u4ef6\u3002","source":"@site/docs/plugin/quickstart.md","sourceDirName":"plugin","slug":"/plugin/quickstart","permalink":"/en/plugin/quickstart","draft":false,"unlisted":false,"editUrl":"https://github.com/tgoai/tgo/edit/main/docs-site/docs/plugin/quickstart.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"quickstart","title":"\u5feb\u901f\u5165\u95e8","sidebar_position":2},"sidebar":"pluginSidebar","previous":{"title":"\u63d2\u4ef6\u6982\u8ff0","permalink":"/en/plugin/overview"},"next":{"title":"\u901a\u8baf\u534f\u8bae","permalink":"/en/plugin/protocol"}}');var r=s(74848),i=s(28453);const o={id:"quickstart",title:"\u5feb\u901f\u5165\u95e8",sidebar_position:2},l="\u5feb\u901f\u5165\u95e8",a={},c=[{value:"\u524d\u7f6e\u6761\u4ef6",id:"\u524d\u7f6e\u6761\u4ef6",level:2},{value:"\u521b\u5efa\u7b2c\u4e00\u4e2a\u63d2\u4ef6",id:"\u521b\u5efa\u7b2c\u4e00\u4e2a\u63d2\u4ef6",level:2},{value:"\u6b65\u9aa4 1\uff1a\u521b\u5efa\u63d2\u4ef6\u76ee\u5f55",id:"\u6b65\u9aa4-1\u521b\u5efa\u63d2\u4ef6\u76ee\u5f55",level:3},{value:"\u6b65\u9aa4 2\uff1a\u7f16\u5199\u63d2\u4ef6\u4ee3\u7801",id:"\u6b65\u9aa4-2\u7f16\u5199\u63d2\u4ef6\u4ee3\u7801",level:3},{value:"\u6b65\u9aa4 3\uff1a\u6d4b\u8bd5\u63d2\u4ef6",id:"\u6b65\u9aa4-3\u6d4b\u8bd5\u63d2\u4ef6",level:3},{value:"\u521b\u5efa\u6d4b\u8bd5\u670d\u52a1\u5668",id:"\u521b\u5efa\u6d4b\u8bd5\u670d\u52a1\u5668",level:4},{value:"\u8fd0\u884c\u6d4b\u8bd5",id:"\u8fd0\u884c\u6d4b\u8bd5",level:4},{value:"\u6b65\u9aa4 4\uff1a\u90e8\u7f72\u63d2\u4ef6",id:"\u6b65\u9aa4-4\u90e8\u7f72\u63d2\u4ef6",level:3},{value:"Node.js \u7248\u672c",id:"nodejs-\u7248\u672c",level:2},{value:"\u8c03\u8bd5\u6280\u5de7",id:"\u8c03\u8bd5\u6280\u5de7",level:2},{value:"1. \u65e5\u5fd7\u8f93\u51fa",id:"1-\u65e5\u5fd7\u8f93\u51fa",level:3},{value:"2. \u67e5\u770b Socket \u72b6\u6001",id:"2-\u67e5\u770b-socket-\u72b6\u6001",level:3},{value:"3. \u4f7f\u7528 netcat \u6d4b\u8bd5",id:"3-\u4f7f\u7528-netcat-\u6d4b\u8bd5",level:3},{value:"\u9879\u76ee\u7ed3\u6784\u5efa\u8bae",id:"\u9879\u76ee\u7ed3\u6784\u5efa\u8bae",level:2},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2}];function d(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"\u5feb\u901f\u5165\u95e8",children:"\u5feb\u901f\u5165\u95e8"})}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u6307\u5357\u5c06\u5e2e\u52a9\u4f60\u5728 5 \u5206\u949f\u5185\u521b\u5efa\u5e76\u8fd0\u884c\u7b2c\u4e00\u4e2a TGO \u63d2\u4ef6\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u524d\u7f6e\u6761\u4ef6",children:"\u524d\u7f6e\u6761\u4ef6"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5df2\u5b89\u88c5 Python 3.8+ \u6216 Node.js 16+"}),"\n",(0,r.jsx)(e.li,{children:"\u4e86\u89e3 JSON \u57fa\u672c\u8bed\u6cd5"}),"\n",(0,r.jsx)(e.li,{children:"TGO \u7cfb\u7edf\u5df2\u90e8\u7f72\u8fd0\u884c"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u521b\u5efa\u7b2c\u4e00\u4e2a\u63d2\u4ef6",children:"\u521b\u5efa\u7b2c\u4e00\u4e2a\u63d2\u4ef6"}),"\n",(0,r.jsx)(e.p,{children:"\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u300c\u8bbf\u5ba2\u9762\u677f\u300d\u63d2\u4ef6\uff0c\u5728\u8bbf\u5ba2\u4fe1\u606f\u9762\u677f\u4e2d\u663e\u793a\u5ba2\u6237\u7684\u8ba2\u5355\u4fe1\u606f\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9aa4-1\u521b\u5efa\u63d2\u4ef6\u76ee\u5f55",children:"\u6b65\u9aa4 1\uff1a\u521b\u5efa\u63d2\u4ef6\u76ee\u5f55"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"mkdir my-first-plugin\ncd my-first-plugin\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9aa4-2\u7f16\u5199\u63d2\u4ef6\u4ee3\u7801",children:"\u6b65\u9aa4 2\uff1a\u7f16\u5199\u63d2\u4ef6\u4ee3\u7801"}),"\n",(0,r.jsxs)(e.p,{children:["\u521b\u5efa ",(0,r.jsx)(e.code,{children:"main.py"})," \u6587\u4ef6\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nTGO \u63d2\u4ef6\u793a\u4f8b - \u8bbf\u5ba2\u8ba2\u5355\u4fe1\u606f\n\u63d2\u4ef6\u4f5c\u4e3a\u5ba2\u6237\u7aef\uff0c\u8fde\u63a5\u5230 TGO \u5bbf\u4e3b\u7a0b\u5e8f\u7684 Unix Socket\n"""\nimport sys\nimport json\nimport socket\nimport struct\nimport signal\n\n# \u63d2\u4ef6\u4fe1\u606f\nPLUGIN_NAME = "visitor-orders"\nPLUGIN_VERSION = "1.0.0"\n\n# TGO \u5bbf\u4e3b\u7a0b\u5e8f\u7684 Socket \u8def\u5f84\nTGO_SOCKET_PATH = "/var/run/tgo/tgo.sock"\n\n\nclass TGOClient:\n    """TGO \u63d2\u4ef6\u5ba2\u6237\u7aef"""\n    \n    def __init__(self, socket_path: str):\n        self.socket_path = socket_path\n        self.sock = None\n        self.running = True\n    \n    def connect(self):\n        """\u8fde\u63a5\u5230 TGO \u5bbf\u4e3b\u7a0b\u5e8f"""\n        self.sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)\n        self.sock.connect(self.socket_path)\n        print(f"[INFO] \u5df2\u8fde\u63a5\u5230 TGO: {self.socket_path}", file=sys.stderr)\n    \n    def disconnect(self):\n        """\u65ad\u5f00\u8fde\u63a5"""\n        if self.sock:\n            self.sock.close()\n            self.sock = None\n    \n    def send_message(self, data: dict):\n        """\u53d1\u9001\u6d88\u606f\uff08\u957f\u5ea6\u524d\u7f00 + JSON\uff09"""\n        json_bytes = json.dumps(data, ensure_ascii=False).encode(\'utf-8\')\n        length = struct.pack(\'>I\', len(json_bytes))\n        self.sock.sendall(length + json_bytes)\n    \n    def recv_message(self) -> dict:\n        """\u63a5\u6536\u6d88\u606f"""\n        length_bytes = self._recv_exact(4)\n        if not length_bytes:\n            return None\n        length = struct.unpack(\'>I\', length_bytes)[0]\n        json_bytes = self._recv_exact(length)\n        if not json_bytes:\n            return None\n        return json.loads(json_bytes.decode(\'utf-8\'))\n    \n    def _recv_exact(self, n: int) -> bytes:\n        """\u7cbe\u786e\u63a5\u6536 n \u5b57\u8282"""\n        data = b\'\'\n        while len(data) < n:\n            chunk = self.sock.recv(n - len(data))\n            if not chunk:\n                return None\n            data += chunk\n        return data\n    \n    def register(self):\n        """\u5411\u5bbf\u4e3b\u6ce8\u518c\u63d2\u4ef6\u80fd\u529b"""\n        self.send_message({\n            "jsonrpc": "2.0",\n            "id": 1,\n            "method": "register",\n            "params": {\n                "name": PLUGIN_NAME,\n                "version": PLUGIN_VERSION,\n                "description": "\u663e\u793a\u8bbf\u5ba2\u7684\u8ba2\u5355\u4fe1\u606f",\n                "capabilities": [\n                    {\n                        "type": "visitor_panel",\n                        "title": "\u5ba2\u6237\u8ba2\u5355",\n                        "icon": "shopping-cart"\n                    }\n                ]\n            }\n        })\n        \n        # \u7b49\u5f85\u6ce8\u518c\u54cd\u5e94\n        response = self.recv_message()\n        if response and response.get("result", {}).get("success"):\n            print(f"[INFO] \u63d2\u4ef6\u6ce8\u518c\u6210\u529f", file=sys.stderr)\n            return True\n        else:\n            print(f"[ERROR] \u63d2\u4ef6\u6ce8\u518c\u5931\u8d25: {response}", file=sys.stderr)\n            return False\n\n\ndef handle_visitor_panel_render(request):\n    """\u5904\u7406\u8bbf\u5ba2\u9762\u677f\u6e32\u67d3\u8bf7\u6c42\uff0c\u8fd4\u56de JSON-UI"""\n    params = request.get("params", {})\n    visitor_id = params.get("visitor_id")\n    \n    # \u8fd9\u91cc\u53ef\u4ee5\u8c03\u7528\u4f60\u7684\u4e1a\u52a1 API \u83b7\u53d6\u771f\u5b9e\u6570\u636e\n    orders = [\n        {"order_id": "ORD-001", "amount": "\xa5299.00", "status": "\u5df2\u5b8c\u6210"},\n        {"order_id": "ORD-002", "amount": "\xa5599.00", "status": "\u5f85\u53d1\u8d27"},\n    ]\n    \n    # \u8fd4\u56de JSON-UI\uff1a\u5305\u542b\u8868\u683c\u548c\u64cd\u4f5c\u6309\u94ae\n    return {\n        "jsonrpc": "2.0",\n        "id": request["id"],\n        "result": {\n            "template": "group",\n            "data": {\n                "items": [\n                    {\n                        "template": "table",\n                        "data": {\n                            "title": "\u6700\u8fd1\u8ba2\u5355",\n                            "columns": [\n                                {"key": "order_id", "label": "\u8ba2\u5355\u53f7"},\n                                {"key": "amount", "label": "\u91d1\u989d"},\n                                {"key": "status", "label": "\u72b6\u6001"}\n                            ],\n                            "rows": orders\n                        }\n                    },\n                    {\n                        "template": "action",\n                        "data": {\n                            "buttons": [\n                                {"id": "view_all", "label": "\u67e5\u770b\u5168\u90e8\u8ba2\u5355", "type": "primary"}\n                            ]\n                        }\n                    }\n                ]\n            }\n        }\n    }\n\n\ndef handle_visitor_panel_event(request):\n    """\u5904\u7406\u8bbf\u5ba2\u9762\u677f\u4e8b\u4ef6\uff0c\u8fd4\u56de JSON-ACTION"""\n    params = request.get("params", {})\n    action_id = params.get("action_id")\n    visitor_id = params.get("visitor_id")\n    \n    if action_id == "view_all":\n        return {\n            "jsonrpc": "2.0",\n            "id": request["id"],\n            "result": {\n                "action": "open_url",\n                "data": {\n                    "url": f"https://crm.example.com/orders?visitor={visitor_id}",\n                    "target": "_blank"\n                }\n            }\n        }\n    \n    return {\n        "jsonrpc": "2.0",\n        "id": request["id"],\n        "result": {"action": "noop", "data": {}}\n    }\n\n\ndef handle_request(request: dict) -> dict:\n    """\u8def\u7531\u8bf7\u6c42\u5230\u5bf9\u5e94\u5904\u7406\u51fd\u6570"""\n    method = request.get("method")\n    \n    handlers = {\n        "visitor_panel/render": handle_visitor_panel_render,\n        "visitor_panel/event": handle_visitor_panel_event,\n    }\n    \n    handler = handlers.get(method)\n    if handler:\n        return handler(request)\n    \n    return {\n        "jsonrpc": "2.0",\n        "id": request.get("id"),\n        "error": {\n            "code": -32601,\n            "message": f"Method not found: {method}"\n        }\n    }\n\n\ndef main():\n    """\u63d2\u4ef6\u4e3b\u51fd\u6570"""\n    client = TGOClient(TGO_SOCKET_PATH)\n    \n    # \u4fe1\u53f7\u5904\u7406\n    def cleanup(signum, frame):\n        client.disconnect()\n        sys.exit(0)\n    \n    signal.signal(signal.SIGTERM, cleanup)\n    signal.signal(signal.SIGINT, cleanup)\n    \n    try:\n        # \u8fde\u63a5\u5230 TGO \u5bbf\u4e3b\u7a0b\u5e8f\n        client.connect()\n        \n        # \u6ce8\u518c\u63d2\u4ef6\n        if not client.register():\n            sys.exit(1)\n        \n        # \u4e3b\u5faa\u73af\uff1a\u7b49\u5f85\u5e76\u5904\u7406\u6765\u81ea\u5bbf\u4e3b\u7684\u8bf7\u6c42\n        while client.running:\n            request = client.recv_message()\n            if request is None:\n                print("[INFO] \u8fde\u63a5\u5df2\u65ad\u5f00", file=sys.stderr)\n                break\n            \n            method = request.get("method")\n            print(f"[DEBUG] \u6536\u5230\u8bf7\u6c42: {method}", file=sys.stderr)\n            \n            # \u5904\u7406 shutdown \u8bf7\u6c42\n            if method == "shutdown":\n                client.send_message({\n                    "jsonrpc": "2.0",\n                    "id": request["id"],\n                    "result": {"success": True}\n                })\n                break\n            \n            # \u5904\u7406\u4e1a\u52a1\u8bf7\u6c42\n            response = handle_request(request)\n            client.send_message(response)\n    \n    except ConnectionRefusedError:\n        print(f"[ERROR] \u65e0\u6cd5\u8fde\u63a5\u5230 TGO: {TGO_SOCKET_PATH}", file=sys.stderr)\n        print("[ERROR] \u8bf7\u786e\u4fdd TGO \u670d\u52a1\u5df2\u542f\u52a8", file=sys.stderr)\n        sys.exit(1)\n    except Exception as e:\n        print(f"[ERROR] \u53d1\u751f\u9519\u8bef: {e}", file=sys.stderr)\n        sys.exit(1)\n    finally:\n        client.disconnect()\n\n\nif __name__ == "__main__":\n    main()\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9aa4-3\u6d4b\u8bd5\u63d2\u4ef6",children:"\u6b65\u9aa4 3\uff1a\u6d4b\u8bd5\u63d2\u4ef6"}),"\n",(0,r.jsx)(e.p,{children:"\u7531\u4e8e\u63d2\u4ef6\u662f\u5ba2\u6237\u7aef\uff0c\u9700\u8981\u5148\u542f\u52a8\u4e00\u4e2a\u6a21\u62df\u7684 TGO \u5bbf\u4e3b\u670d\u52a1\u5668\u8fdb\u884c\u6d4b\u8bd5\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"\u521b\u5efa\u6d4b\u8bd5\u670d\u52a1\u5668",children:"\u521b\u5efa\u6d4b\u8bd5\u670d\u52a1\u5668"}),"\n",(0,r.jsxs)(e.p,{children:["\u521b\u5efa ",(0,r.jsx)(e.code,{children:"test_server.py"})," \u6a21\u62df TGO \u5bbf\u4e3b\u7a0b\u5e8f\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\u6d4b\u8bd5\u670d\u52a1\u5668 - \u6a21\u62df TGO \u5bbf\u4e3b\u7a0b\u5e8f"""\nimport os\nimport socket\nimport struct\nimport json\n\nSOCKET_PATH = "/var/run/tgo/tgo.sock"\n\ndef recv_message(conn):\n    """\u63a5\u6536\u6d88\u606f"""\n    length_bytes = conn.recv(4)\n    if not length_bytes:\n        return None\n    length = struct.unpack(\'>I\', length_bytes)[0]\n    json_bytes = conn.recv(length)\n    return json.loads(json_bytes.decode(\'utf-8\'))\n\ndef send_message(conn, data):\n    """\u53d1\u9001\u6d88\u606f"""\n    json_bytes = json.dumps(data).encode(\'utf-8\')\n    conn.sendall(struct.pack(\'>I\', len(json_bytes)) + json_bytes)\n\n# \u51c6\u5907 Socket\nos.makedirs(os.path.dirname(SOCKET_PATH), exist_ok=True)\nif os.path.exists(SOCKET_PATH):\n    os.unlink(SOCKET_PATH)\n\nserver = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)\nserver.bind(SOCKET_PATH)\nserver.listen(1)\nprint(f"[TGO \u6a21\u62df\u670d\u52a1\u5668] \u76d1\u542c: {SOCKET_PATH}")\nprint("[TGO \u6a21\u62df\u670d\u52a1\u5668] \u7b49\u5f85\u63d2\u4ef6\u8fde\u63a5...")\n\nconn, _ = server.accept()\nprint("[TGO \u6a21\u62df\u670d\u52a1\u5668] \u63d2\u4ef6\u5df2\u8fde\u63a5!")\n\n# \u63a5\u6536\u63d2\u4ef6\u7684 register \u8bf7\u6c42\nrequest = recv_message(conn)\nprint(f"\\n=== \u6536\u5230 register \u8bf7\u6c42 ===")\nprint(json.dumps(request, indent=2, ensure_ascii=False))\n\n# \u8fd4\u56de\u6ce8\u518c\u6210\u529f\nsend_message(conn, {\n    "jsonrpc": "2.0",\n    "id": request["id"],\n    "result": {"success": True, "plugin_id": "plugin_001", "host_version": "1.0.0"}\n})\nprint("[TGO \u6a21\u62df\u670d\u52a1\u5668] \u5df2\u53d1\u9001\u6ce8\u518c\u6210\u529f\u54cd\u5e94")\n\n# \u53d1\u9001\u6e32\u67d3\u8bf7\u6c42\nprint("\\n=== \u53d1\u9001 visitor_panel/render \u8bf7\u6c42 ===")\nsend_message(conn, {\n    "jsonrpc": "2.0", "id": 2,\n    "method": "visitor_panel/render",\n    "params": {"visitor_id": "v_12345"}\n})\nresponse = recv_message(conn)\nprint("\u6536\u5230\u54cd\u5e94 (JSON-UI):")\nprint(json.dumps(response, indent=2, ensure_ascii=False))\n\n# \u53d1\u9001\u4e8b\u4ef6\u8bf7\u6c42\nprint("\\n=== \u53d1\u9001 visitor_panel/event \u8bf7\u6c42 ===")\nsend_message(conn, {\n    "jsonrpc": "2.0", "id": 3,\n    "method": "visitor_panel/event",\n    "params": {"action_id": "view_all", "visitor_id": "v_12345"}\n})\nresponse = recv_message(conn)\nprint("\u6536\u5230\u54cd\u5e94 (JSON-ACTION):")\nprint(json.dumps(response, indent=2, ensure_ascii=False))\n\n# \u53d1\u9001 shutdown\nprint("\\n=== \u53d1\u9001 shutdown \u8bf7\u6c42 ===")\nsend_message(conn, {"jsonrpc": "2.0", "id": 99, "method": "shutdown"})\nresponse = recv_message(conn)\nprint("\u6536\u5230\u54cd\u5e94:", response)\n\nconn.close()\nserver.close()\nos.unlink(SOCKET_PATH)\nprint("\\n[TGO \u6a21\u62df\u670d\u52a1\u5668] \u6d4b\u8bd5\u5b8c\u6210!")\n'})}),"\n",(0,r.jsx)(e.h4,{id:"\u8fd0\u884c\u6d4b\u8bd5",children:"\u8fd0\u884c\u6d4b\u8bd5"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u7ec8\u7aef 1"}),"\uff1a\u542f\u52a8\u6d4b\u8bd5\u670d\u52a1\u5668"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u521b\u5efa\u76ee\u5f55\uff08\u9700\u8981\u6743\u9650\uff09\nsudo mkdir -p /var/run/tgo\nsudo chown $USER /var/run/tgo\n\n# \u542f\u52a8\u6d4b\u8bd5\u670d\u52a1\u5668\npython3 test_server.py\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u7ec8\u7aef 2"}),"\uff1a\u542f\u52a8\u63d2\u4ef6"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"python3 main.py\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u9884\u671f\u8f93\u51fa\uff08JSON-ACTION\uff09\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "jsonrpc": "2.0",\n  "id": 3,\n  "result": {\n    "action": "open_url",\n    "data": {\n      "url": "https://crm.example.com/orders?visitor=v_12345",\n      "target": "_blank"\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9aa4-4\u90e8\u7f72\u63d2\u4ef6",children:"\u6b65\u9aa4 4\uff1a\u90e8\u7f72\u63d2\u4ef6"}),"\n",(0,r.jsxs)(e.p,{children:["\u521b\u5efa\u63d2\u4ef6\u914d\u7f6e\u6587\u4ef6 ",(0,r.jsx)(e.code,{children:"plugin.json"}),"\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "name": "visitor-orders",\n  "version": "1.0.0",\n  "description": "\u663e\u793a\u8bbf\u5ba2\u7684\u8ba2\u5355\u4fe1\u606f",\n  "command": "python3",\n  "args": ["main.py"],\n  "working_directory": "/path/to/my-first-plugin"\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u90e8\u7f72\u63d2\u4ef6\u5230 TGO\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u590d\u5236\u63d2\u4ef6\u5230 TGO \u63d2\u4ef6\u76ee\u5f55\ncp -r my-first-plugin /path/to/tgo/plugins/\n\n# TGO \u4f1a\u81ea\u52a8\u542f\u52a8\u63d2\u4ef6\u8fdb\u7a0b\n# \u63d2\u4ef6\u542f\u52a8\u540e\u4f1a\u81ea\u52a8\u8fde\u63a5\u5230 TGO \u5e76\u6ce8\u518c\u80fd\u529b\n./tgo.sh restart\n"})}),"\n",(0,r.jsx)(e.admonition,{title:"\u63d2\u4ef6\u751f\u547d\u5468\u671f",type:"tip",children:(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"TGO \u542f\u52a8\u65f6\uff0c\u4f1a\u81ea\u52a8\u542f\u52a8\u914d\u7f6e\u7684\u63d2\u4ef6\u8fdb\u7a0b"}),"\n",(0,r.jsxs)(e.li,{children:["\u63d2\u4ef6\u8fdb\u7a0b\u542f\u52a8\u540e\uff0c\u81ea\u52a8\u8fde\u63a5\u5230 TGO \u7684 Socket\uff08",(0,r.jsx)(e.code,{children:"/var/run/tgo/tgo.sock"}),"\uff09"]}),"\n",(0,r.jsxs)(e.li,{children:["\u63d2\u4ef6\u53d1\u9001 ",(0,r.jsx)(e.code,{children:"register"})," \u8bf7\u6c42\u6ce8\u518c\u80fd\u529b"]}),"\n",(0,r.jsx)(e.li,{children:"TGO \u6536\u5230\u6ce8\u518c\u540e\uff0c\u63d2\u4ef6\u5373\u53ef\u63a5\u6536\u4e1a\u52a1\u8bf7\u6c42"}),"\n"]})}),"\n",(0,r.jsx)(e.h2,{id:"nodejs-\u7248\u672c",children:"Node.js \u7248\u672c"}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u4f60\u66f4\u719f\u6089 JavaScript\uff0c\u53ef\u4ee5\u4f7f\u7528 Node.js \u5f00\u53d1\uff1a"}),"\n",(0,r.jsxs)(e.p,{children:["\u521b\u5efa ",(0,r.jsx)(e.code,{children:"main.js"})," \u6587\u4ef6\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"#!/usr/bin/env node\n/**\n * TGO \u63d2\u4ef6\u793a\u4f8b - \u8bbf\u5ba2\u8ba2\u5355\u4fe1\u606f (Node.js \u7248\u672c)\n * \u63d2\u4ef6\u4f5c\u4e3a\u5ba2\u6237\u7aef\uff0c\u8fde\u63a5\u5230 TGO \u5bbf\u4e3b\u7a0b\u5e8f\u7684 Unix Socket\n */\nconst net = require('net');\n\n// \u63d2\u4ef6\u4fe1\u606f\nconst PLUGIN_NAME = 'visitor-orders';\nconst PLUGIN_VERSION = '1.0.0';\n\n// TGO \u5bbf\u4e3b\u7a0b\u5e8f\u7684 Socket \u8def\u5f84\nconst TGO_SOCKET_PATH = '/var/run/tgo/tgo.sock';\n\n/**\n * \u4ece Buffer \u8bfb\u53d6\u6d88\u606f\n */\nfunction parseMessages(buffer) {\n  const messages = [];\n  let offset = 0;\n  \n  while (offset + 4 <= buffer.length) {\n    const length = buffer.readUInt32BE(offset);\n    if (offset + 4 + length > buffer.length) break;\n    \n    const jsonStr = buffer.slice(offset + 4, offset + 4 + length).toString('utf-8');\n    messages.push(JSON.parse(jsonStr));\n    offset += 4 + length;\n  }\n  \n  return { messages, remaining: buffer.slice(offset) };\n}\n\n/**\n * \u5e8f\u5217\u5316\u6d88\u606f\u4e3a Buffer\n */\nfunction serializeMessage(data) {\n  const jsonBuffer = Buffer.from(JSON.stringify(data), 'utf-8');\n  const lengthBuffer = Buffer.alloc(4);\n  lengthBuffer.writeUInt32BE(jsonBuffer.length, 0);\n  return Buffer.concat([lengthBuffer, jsonBuffer]);\n}\n\nfunction handleVisitorPanelRender(request) {\n  const { visitor_id } = request.params || {};\n  \n  const orders = [\n    { order_id: 'ORD-001', amount: '\xa5299.00', status: '\u5df2\u5b8c\u6210' },\n    { order_id: 'ORD-002', amount: '\xa5599.00', status: '\u5f85\u53d1\u8d27' }\n  ];\n  \n  return {\n    jsonrpc: '2.0',\n    id: request.id,\n    result: {\n      template: 'group',\n      data: {\n        items: [\n          {\n            template: 'table',\n            data: {\n              title: '\u6700\u8fd1\u8ba2\u5355',\n              columns: [\n                { key: 'order_id', label: '\u8ba2\u5355\u53f7' },\n                { key: 'amount', label: '\u91d1\u989d' },\n                { key: 'status', label: '\u72b6\u6001' }\n              ],\n              rows: orders\n            }\n          },\n          {\n            template: 'action',\n            data: {\n              buttons: [\n                { id: 'view_all', label: '\u67e5\u770b\u5168\u90e8\u8ba2\u5355', type: 'primary' }\n              ]\n            }\n          }\n        ]\n      }\n    }\n  };\n}\n\nfunction handleVisitorPanelEvent(request) {\n  const { action_id, visitor_id } = request.params || {};\n  \n  if (action_id === 'view_all') {\n    return {\n      jsonrpc: '2.0',\n      id: request.id,\n      result: {\n        action: 'open_url',\n        data: {\n          url: `https://crm.example.com/orders?visitor=${visitor_id}`,\n          target: '_blank'\n        }\n      }\n    };\n  }\n  \n  return {\n    jsonrpc: '2.0',\n    id: request.id,\n    result: { action: 'noop', data: {} }\n  };\n}\n\nfunction handleRequest(request) {\n  const { method } = request;\n  \n  switch (method) {\n    case 'visitor_panel/render':\n      return handleVisitorPanelRender(request);\n    case 'visitor_panel/event':\n      return handleVisitorPanelEvent(request);\n    default:\n      return {\n        jsonrpc: '2.0',\n        id: request.id,\n        error: { code: -32601, message: `Method not found: ${method}` }\n      };\n  }\n}\n\n// \u8fde\u63a5\u5230 TGO \u5bbf\u4e3b\u7a0b\u5e8f\nconst client = net.createConnection(TGO_SOCKET_PATH, () => {\n  console.error(`[INFO] \u5df2\u8fde\u63a5\u5230 TGO: ${TGO_SOCKET_PATH}`);\n  \n  // \u53d1\u9001 register \u8bf7\u6c42\n  client.write(serializeMessage({\n    jsonrpc: '2.0',\n    id: 1,\n    method: 'register',\n    params: {\n      name: PLUGIN_NAME,\n      version: PLUGIN_VERSION,\n      description: '\u663e\u793a\u8bbf\u5ba2\u7684\u8ba2\u5355\u4fe1\u606f',\n      capabilities: [\n        {\n          type: 'visitor_panel',\n          title: '\u5ba2\u6237\u8ba2\u5355',\n          icon: 'shopping-cart'\n        }\n      ]\n    }\n  }));\n});\n\nlet buffer = Buffer.alloc(0);\nlet registered = false;\n\nclient.on('data', (data) => {\n  buffer = Buffer.concat([buffer, data]);\n  const { messages, remaining } = parseMessages(buffer);\n  buffer = remaining;\n  \n  for (const message of messages) {\n    // \u5904\u7406\u6ce8\u518c\u54cd\u5e94\n    if (!registered && message.result?.success) {\n      console.error('[INFO] \u63d2\u4ef6\u6ce8\u518c\u6210\u529f');\n      registered = true;\n      continue;\n    }\n    \n    // \u5904\u7406 shutdown \u8bf7\u6c42\n    if (message.method === 'shutdown') {\n      client.write(serializeMessage({\n        jsonrpc: '2.0',\n        id: message.id,\n        result: { success: true }\n      }));\n      client.end();\n      return;\n    }\n    \n    // \u5904\u7406\u4e1a\u52a1\u8bf7\u6c42\n    if (message.method) {\n      console.error(`[DEBUG] \u6536\u5230\u8bf7\u6c42: ${message.method}`);\n      const response = handleRequest(message);\n      client.write(serializeMessage(response));\n    }\n  }\n});\n\nclient.on('error', (err) => {\n  console.error(`[ERROR] \u8fde\u63a5\u9519\u8bef: ${err.message}`);\n  console.error('[ERROR] \u8bf7\u786e\u4fdd TGO \u670d\u52a1\u5df2\u542f\u52a8');\n  process.exit(1);\n});\n\nclient.on('close', () => {\n  console.error('[INFO] \u8fde\u63a5\u5df2\u5173\u95ed');\n  process.exit(0);\n});\n\n// \u4f18\u96c5\u5173\u95ed\nprocess.on('SIGTERM', () => {\n  client.end();\n  process.exit(0);\n});\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u8c03\u8bd5\u6280\u5de7",children:"\u8c03\u8bd5\u6280\u5de7"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u65e5\u5fd7\u8f93\u51fa",children:"1. \u65e5\u5fd7\u8f93\u51fa"}),"\n",(0,r.jsx)(e.p,{children:"\u8c03\u8bd5\u65e5\u5fd7\u8f93\u51fa\u5230 stderr\uff08\u4e0d\u5f71\u54cd Socket \u901a\u8baf\uff09\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'import sys\n\ndef log(message):\n    print(f"[DEBUG] {message}", file=sys.stderr)\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",children:"function log(message) {\n  console.error(`[DEBUG] ${message}`);\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u67e5\u770b-socket-\u72b6\u6001",children:"2. \u67e5\u770b Socket \u72b6\u6001"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u68c0\u67e5 TGO Socket \u6587\u4ef6\u662f\u5426\u5b58\u5728\nls -la /var/run/tgo/tgo.sock\n\n# \u4f7f\u7528 lsof \u67e5\u770b Socket \u8fde\u63a5\nlsof -U | grep tgo.sock\n"})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u4f7f\u7528-netcat-\u6d4b\u8bd5",children:"3. \u4f7f\u7528 netcat \u6d4b\u8bd5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u68c0\u67e5 Socket \u662f\u5426\u53ef\u8fde\u63a5\nnc -U /var/run/tgo/tgo.sock\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u9879\u76ee\u7ed3\u6784\u5efa\u8bae",children:"\u9879\u76ee\u7ed3\u6784\u5efa\u8bae"}),"\n",(0,r.jsx)(e.p,{children:"\u4e00\u4e2a\u5b8c\u6574\u7684\u63d2\u4ef6\u9879\u76ee\u7ed3\u6784\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"my-plugin/\n\u251c\u2500\u2500 plugin.json          # \u63d2\u4ef6\u914d\u7f6e\u6587\u4ef6\n\u251c\u2500\u2500 main.py              # \u5165\u53e3\u6587\u4ef6\n\u251c\u2500\u2500 handlers/            # \u8bf7\u6c42\u5904\u7406\u5668\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 visitor_panel.py\n\u2502   \u2514\u2500\u2500 chat_toolbar.py\n\u251c\u2500\u2500 services/            # \u4e1a\u52a1\u903b\u8f91\n\u2502   \u2514\u2500\u2500 order_service.py\n\u251c\u2500\u2500 tests/               # \u6d4b\u8bd5\u6587\u4ef6\n\u2502   \u2514\u2500\u2500 test_plugin.py\n\u2514\u2500\u2500 README.md            # \u63d2\u4ef6\u8bf4\u660e\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"/plugin/protocol",children:"\u901a\u8baf\u534f\u8bae"})," - \u6df1\u5165\u4e86\u89e3 JSON-RPC \u534f\u8bae\u7ec6\u8282"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"/plugin/extension-points",children:"\u53ef\u63d2\u70b9\u8be6\u89e3"})," - \u4e86\u89e3\u6bcf\u4e2a\u53ef\u63d2\u70b9\u7684\u5177\u4f53\u7528\u6cd5"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"/plugin/templates",children:"\u6a21\u7248\u89c4\u8303"})," - \u5b66\u4e60\u5982\u4f55\u5b9a\u4e49 UI \u6a21\u7248"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"/plugin/examples",children:"\u5b8c\u6574\u793a\u4f8b"})," - \u67e5\u770b\u66f4\u591a\u5b9e\u9645\u5e94\u7528\u6848\u4f8b"]}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}}}]);