"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[2435],{26378:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>c,default:()=>o,frontMatter:()=>i,metadata:()=>l,toc:()=>a});const l=JSON.parse('{"id":"development/restart-upgrade","title":"\u91cd\u542f\u548c\u5347\u7ea7","description":"\u672c\u9875\u4ecb\u7ecd\u5982\u4f55\u7ba1\u7406 TGO \u670d\u52a1\u7684\u542f\u505c\u548c\u7248\u672c\u5347\u7ea7\u3002","source":"@site/docs/development/restart-upgrade.md","sourceDirName":"development","slug":"/development/restart-upgrade","permalink":"/development/restart-upgrade","draft":false,"unlisted":false,"editUrl":"https://github.com/tgoai/tgo/edit/main/docs-site/docs/development/restart-upgrade.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"restart-upgrade","title":"\u91cd\u542f\u548c\u5347\u7ea7","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"\u6e90\u7801\u90e8\u7f72","permalink":"/development/source-deploy"},"next":{"title":"\u8c03\u8bd5\u5de5\u5177","permalink":"/development/debug-tools"}}');var d=s(74848),r=s(28453);const i={id:"restart-upgrade",title:"\u91cd\u542f\u548c\u5347\u7ea7",sidebar_position:2},c="\u91cd\u542f\u548c\u5347\u7ea7",h={},a=[{value:"\u670d\u52a1\u7ba1\u7406",id:"\u670d\u52a1\u7ba1\u7406",level:2},{value:"\u542f\u52a8\u670d\u52a1",id:"\u542f\u52a8\u670d\u52a1",level:3},{value:"\u505c\u6b62\u670d\u52a1",id:"\u505c\u6b62\u670d\u52a1",level:3},{value:"\u91cd\u542f\u670d\u52a1",id:"\u91cd\u542f\u670d\u52a1",level:3},{value:"\u91cd\u542f\u5355\u4e2a\u670d\u52a1",id:"\u91cd\u542f\u5355\u4e2a\u670d\u52a1",level:3},{value:"\u7248\u672c\u5347\u7ea7",id:"\u7248\u672c\u5347\u7ea7",level:2},{value:"\u5347\u7ea7\u5230\u6700\u65b0\u7248\u672c",id:"\u5347\u7ea7\u5230\u6700\u65b0\u7248\u672c",level:3},{value:"\u5347\u7ea7\u547d\u4ee4\u9009\u9879",id:"\u5347\u7ea7\u547d\u4ee4\u9009\u9879",level:3},{value:"\u5b89\u88c5\u6a21\u5f0f\u8bb0\u5fc6",id:"\u5b89\u88c5\u6a21\u5f0f\u8bb0\u5fc6",level:3},{value:"\u5347\u7ea7\u5230\u7279\u5b9a\u7248\u672c",id:"\u5347\u7ea7\u5230\u7279\u5b9a\u7248\u672c",level:3},{value:"\u5378\u8f7d",id:"\u5378\u8f7d",level:2},{value:"\u505c\u6b62\u5e76\u5220\u9664\u670d\u52a1",id:"\u505c\u6b62\u5e76\u5220\u9664\u670d\u52a1",level:3},{value:"\u5b8c\u5168\u6e05\u7406",id:"\u5b8c\u5168\u6e05\u7406",level:3},{value:"\u5907\u4efd\u4e0e\u6062\u590d",id:"\u5907\u4efd\u4e0e\u6062\u590d",level:2},{value:"\u5907\u4efd\u6570\u636e",id:"\u5907\u4efd\u6570\u636e",level:3},{value:"\u6062\u590d\u6570\u636e",id:"\u6062\u590d\u6570\u636e",level:3},{value:"\u6570\u636e\u5e93\u5907\u4efd",id:"\u6570\u636e\u5e93\u5907\u4efd",level:3},{value:"\u5065\u5eb7\u68c0\u67e5",id:"\u5065\u5eb7\u68c0\u67e5",level:2},{value:"\u6545\u969c\u6392\u9664",id:"\u6545\u969c\u6392\u9664",level:2},{value:"\u670d\u52a1\u65e0\u6cd5\u542f\u52a8",id:"\u670d\u52a1\u65e0\u6cd5\u542f\u52a8",level:3},{value:"\u5347\u7ea7\u540e\u5f02\u5e38",id:"\u5347\u7ea7\u540e\u5f02\u5e38",level:3}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"\u91cd\u542f\u548c\u5347\u7ea7",children:"\u91cd\u542f\u548c\u5347\u7ea7"})}),"\n",(0,d.jsx)(n.p,{children:"\u672c\u9875\u4ecb\u7ecd\u5982\u4f55\u7ba1\u7406 TGO \u670d\u52a1\u7684\u542f\u505c\u548c\u7248\u672c\u5347\u7ea7\u3002"}),"\n",(0,d.jsx)(n.h2,{id:"\u670d\u52a1\u7ba1\u7406",children:"\u670d\u52a1\u7ba1\u7406"}),"\n",(0,d.jsx)(n.h3,{id:"\u542f\u52a8\u670d\u52a1",children:"\u542f\u52a8\u670d\u52a1"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"./tgo.sh up\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u6e90\u7801\u6a21\u5f0f\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"./tgo.sh up --source\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u505c\u6b62\u670d\u52a1",children:"\u505c\u6b62\u670d\u52a1"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"./tgo.sh down\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u505c\u6b62\u5e76\u5220\u9664\u6570\u636e\u5377\uff08",(0,d.jsx)(n.strong,{children:"\u4f1a\u4e22\u5931\u6570\u636e"}),"\uff09\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"./tgo.sh down --volumes\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u91cd\u542f\u670d\u52a1",children:"\u91cd\u542f\u670d\u52a1"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"./tgo.sh down\n./tgo.sh up\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u91cd\u542f\u5355\u4e2a\u670d\u52a1",children:"\u91cd\u542f\u5355\u4e2a\u670d\u52a1"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"docker compose restart tgo-api\n"})}),"\n",(0,d.jsx)(n.h2,{id:"\u7248\u672c\u5347\u7ea7",children:"\u7248\u672c\u5347\u7ea7"}),"\n",(0,d.jsx)(n.h3,{id:"\u5347\u7ea7\u5230\u6700\u65b0\u7248\u672c",children:"\u5347\u7ea7\u5230\u6700\u65b0\u7248\u672c"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"./tgo.sh upgrade\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"upgrade"})," \u547d\u4ee4\u4f1a\u81ea\u52a8\uff1a"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"\u62c9\u53d6\u6700\u65b0\u4ee3\u7801"}),"\n",(0,d.jsx)(n.li,{children:"\u66f4\u65b0 Docker \u955c\u50cf"}),"\n",(0,d.jsx)(n.li,{children:"\u6267\u884c\u6570\u636e\u5e93\u8fc1\u79fb"}),"\n",(0,d.jsx)(n.li,{children:"\u91cd\u542f\u6240\u6709\u670d\u52a1"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u5347\u7ea7\u547d\u4ee4\u9009\u9879",children:"\u5347\u7ea7\u547d\u4ee4\u9009\u9879"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"./tgo.sh upgrade [--source] [--cn]\n"})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u9009\u9879"}),(0,d.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"--source"})}),(0,d.jsx)(n.td,{children:"\u4ece\u6e90\u7801\u6784\u5efa\uff08\u800c\u975e\u4f7f\u7528\u9884\u6784\u5efa\u955c\u50cf\uff09"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"--cn"})}),(0,d.jsx)(n.td,{children:"\u4f7f\u7528\u56fd\u5185\u955c\u50cf\u52a0\u901f"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"\u5b89\u88c5\u6a21\u5f0f\u8bb0\u5fc6",children:"\u5b89\u88c5\u6a21\u5f0f\u8bb0\u5fc6"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"upgrade"})," \u4f1a\u8bb0\u4f4f\u9996\u6b21\u5b89\u88c5\u65f6\u7684\u6a21\u5f0f\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# \u9996\u6b21\u4f7f\u7528\u56fd\u5185\u955c\u50cf\u5b89\u88c5\n./tgo.sh install --cn\n\n# \u4e4b\u540e\u5347\u7ea7\u81ea\u52a8\u4f7f\u7528 --cn\n./tgo.sh upgrade\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u914d\u7f6e\u4fdd\u5b58\u5728 ",(0,d.jsx)(n.code,{children:"./data/.tgo-install-mode"})," \u6587\u4ef6\u4e2d\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"\u5347\u7ea7\u5230\u7279\u5b9a\u7248\u672c",children:"\u5347\u7ea7\u5230\u7279\u5b9a\u7248\u672c"}),"\n",(0,d.jsx)(n.p,{children:"\u5982\u9700\u5347\u7ea7\u5230\u7279\u5b9a\u7248\u672c\uff0c\u53ef\u4ee5\u624b\u52a8\u64cd\u4f5c\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# 1. \u505c\u6b62\u670d\u52a1\n./tgo.sh down\n\n# 2. \u62c9\u53d6\u7279\u5b9a\u7248\u672c\ngit fetch origin\ngit checkout v1.0.0\n\n# 3. \u91cd\u65b0\u5b89\u88c5\n./tgo.sh install\n"})}),"\n",(0,d.jsx)(n.h2,{id:"\u5378\u8f7d",children:"\u5378\u8f7d"}),"\n",(0,d.jsx)(n.h3,{id:"\u505c\u6b62\u5e76\u5220\u9664\u670d\u52a1",children:"\u505c\u6b62\u5e76\u5220\u9664\u670d\u52a1"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"./tgo.sh uninstall\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u8be5\u547d\u4ee4\u4f1a\uff1a"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"\u505c\u6b62\u6240\u6709\u5bb9\u5668"}),"\n",(0,d.jsx)(n.li,{children:"\u5220\u9664\u5bb9\u5668"}),"\n",(0,d.jsx)(n.li,{children:"\u8be2\u95ee\u662f\u5426\u5220\u9664\u6570\u636e"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u5b8c\u5168\u6e05\u7406",children:"\u5b8c\u5168\u6e05\u7406"}),"\n",(0,d.jsx)(n.p,{children:"\u5982\u9700\u5b8c\u5168\u6e05\u7406\u6240\u6709\u6570\u636e\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# \u505c\u6b62\u670d\u52a1\n./tgo.sh down --volumes\n\n# \u5220\u9664\u6570\u636e\u76ee\u5f55\nrm -rf ./data\n\n# \u5220\u9664\u914d\u7f6e\u6587\u4ef6\nrm -f .env\nrm -rf ./envs\n"})}),"\n",(0,d.jsx)(n.h2,{id:"\u5907\u4efd\u4e0e\u6062\u590d",children:"\u5907\u4efd\u4e0e\u6062\u590d"}),"\n",(0,d.jsx)(n.h3,{id:"\u5907\u4efd\u6570\u636e",children:"\u5907\u4efd\u6570\u636e"}),"\n",(0,d.jsxs)(n.p,{children:["\u4e3b\u8981\u6570\u636e\u5b58\u50a8\u5728 ",(0,d.jsx)(n.code,{children:"./data"})," \u76ee\u5f55\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# \u521b\u5efa\u5907\u4efd\ntar -czvf tgo-backup-$(date +%Y%m%d).tar.gz ./data\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u6062\u590d\u6570\u636e",children:"\u6062\u590d\u6570\u636e"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# \u505c\u6b62\u670d\u52a1\n./tgo.sh down\n\n# \u6062\u590d\u6570\u636e\ntar -xzvf tgo-backup-20240101.tar.gz\n\n# \u542f\u52a8\u670d\u52a1\n./tgo.sh up\n"})}),"\n",(0,d.jsx)(n.h3,{id:"\u6570\u636e\u5e93\u5907\u4efd",children:"\u6570\u636e\u5e93\u5907\u4efd"}),"\n",(0,d.jsx)(n.p,{children:"\u5355\u72ec\u5907\u4efd PostgreSQL \u6570\u636e\u5e93\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"# \u5bfc\u51fa\u6570\u636e\u5e93\ndocker compose exec postgres pg_dump -U tgo tgo > tgo-db-backup.sql\n\n# \u6062\u590d\u6570\u636e\u5e93\ndocker compose exec -T postgres psql -U tgo tgo < tgo-db-backup.sql\n"})}),"\n",(0,d.jsx)(n.h2,{id:"\u5065\u5eb7\u68c0\u67e5",children:"\u5065\u5eb7\u68c0\u67e5"}),"\n",(0,d.jsx)(n.p,{children:"\u68c0\u67e5\u6240\u6709\u670d\u52a1\u72b6\u6001\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"./tgo.sh doctor\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u8f93\u51fa\u793a\u4f8b\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"=========================================\n  TGO Service Health Check\n=========================================\n\n  \u2705 tgo-api           running (healthy)\n  \u2705 tgo-ai            running (healthy)\n  \u2705 tgo-rag           running (healthy)\n  \u2705 tgo-web           running\n  \u2705 postgres          running (healthy)\n  \u2705 redis             running (healthy)\n  \u2705 nginx             running\n\n-----------------------------------------\nSummary: 7/7 services healthy\n"})}),"\n",(0,d.jsx)(n.h2,{id:"\u6545\u969c\u6392\u9664",children:"\u6545\u969c\u6392\u9664"}),"\n",(0,d.jsx)(n.h3,{id:"\u670d\u52a1\u65e0\u6cd5\u542f\u52a8",children:"\u670d\u52a1\u65e0\u6cd5\u542f\u52a8"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"\u67e5\u770b\u65e5\u5fd7\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"docker compose logs -f <\u670d\u52a1\u540d>\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"\u68c0\u67e5\u8d44\u6e90\u4f7f\u7528\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"docker stats\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"\u91cd\u5efa\u5bb9\u5668\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"./tgo.sh down\n./tgo.sh install\n"})}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u5347\u7ea7\u540e\u5f02\u5e38",children:"\u5347\u7ea7\u540e\u5f02\u5e38"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"\u68c0\u67e5\u662f\u5426\u6709\u6570\u636e\u5e93\u8fc1\u79fb\u5931\u8d25"}),"\n",(0,d.jsxs)(n.li,{children:["\u56de\u6eda\u5230\u4e4b\u524d\u7248\u672c\uff1a","\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"git checkout <\u4e4b\u524d\u7684\u7248\u672c>\n./tgo.sh install\n"})}),"\n"]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(t,{...e})}):t(e)}}}]);